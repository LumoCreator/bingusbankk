<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BingusBank | –¢–≤–æ–π –Ω–∞–¥–µ–∂–Ω—ã–π –∫–æ—Ç-–±–∞–Ω–∫–∏—Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion, runTransaction, collection, query, where, getDocs } from "https://www.gstatic.com";

        // –¢–í–û–ô –ö–û–ù–§–ò–ì
        const firebaseConfig = {
          apiKey: "AIzaSyBHPwgsuDC-UpfsJ5GFSu2jK5DDMokqSHs",
          authDomain: "bingusbank.firebaseapp.com",
          databaseURL: "https://bingusbank-default-rtdb.firebaseio.com",
          projectId: "bingusbank",
          storageBucket: "bingusbank.firebasestorage.app",
          messagingSenderId: "208242991541",
          appId: "1:208242991541:web:ffb52a2c8e785d1ea939fc",
          measurementId: "G-R0L9G6J6M8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        window.showScreen = (screenId) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        };

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        window.handleSignUp = async () => {
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            const name = document.getElementById('reg-name').value;
            if(!email || !pass || !name) return alert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!");
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const cardNum = Array.from({length: 16}, () => Math.floor(Math.random() * 10)).join('');
                const cvv = Math.floor(100 + Math.random() * 900);
                
                await setDoc(doc(db, "users", userCredential.user.uid), {
                    name, email, cardNum, cvv, exp: "01/30", balance: 10000, history: []
                });
                await setDoc(doc(db, "cards", cardNum), { uid: userCredential.user.uid, name: name });
                alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!");
            } catch (e) { alert("–û—à–∏–±–∫–∞: " + e.message); }
        };

        // –í—Ö–æ–¥
        window.handleLogin = async () => {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            try { await signInWithEmailAndPassword(auth, email, pass); } 
            catch (e) { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å"); }
        };

        // –ü–µ—Ä–µ–≤–æ–¥ (–ø–æ –∫–∞—Ä—Ç–µ –∏–ª–∏ –ø–æ—á—Ç–µ)
        window.handleTransfer = async () => {
            const targetInput = document.getElementById('target-card').value;
            const amount = parseFloat(document.getElementById('transfer-amount').value);
            if(amount <= 0) return alert("–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0");
            
            const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:");
            if(!pass) return;

            try {
                let targetUid;
                // –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ä—Ç–µ
                const cardSnap = await getDoc(doc(db, "cards", targetInput));
                if(cardSnap.exists()) {
                    targetUid = cardSnap.data().uid;
                } else {
                    // –ü–æ–∏—Å–∫ –ø–æ email
                    const q = query(collection(db, "users"), where("email", "==", targetInput));
                    const qSnap = await getDocs(q);
                    if(!qSnap.empty) targetUid = qSnap.docs[0].id;
                }

                if(!targetUid) throw new Error("–ü–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");

                await runTransaction(db, async (transaction) => {
                    const sRef = doc(db, "users", auth.currentUser.uid);
                    const rRef = doc(db, "users", targetUid);
                    const sDoc = await transaction.get(sRef);
                    const rDoc = await transaction.get(rRef);

                    if (sDoc.data().balance < amount) throw "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!";

                    transaction.update(sRef, {
                        balance: sDoc.data().balance - amount,
                        history: arrayUnion({type: 'out', amount, to: targetInput, date: new Date().toLocaleString()})
                    });
                    transaction.update(rRef, {
                        balance: rDoc.data().balance + amount,
                        history: arrayUnion({type: 'in', amount, from: sDoc.data().name, date: new Date().toLocaleString()})
                    });
                });
                alert("–£—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ!");
                showScreen('main-screen');
            } catch (e) { alert(e); }
        };

        // QR –ó–∞–ø—Ä–æ—Å
        window.generateQR = () => {
            const amt = document.getElementById('req-amount').value;
            const userRef = doc(db, "users", auth.currentUser.uid);
            getDoc(userRef).then(snap => {
                const qrData = JSON.stringify({ card: snap.data().cardNum, amount: amt, name: snap.data().name });
                document.getElementById('qrcode').innerHTML = "";
                new QRCode(document.getElementById("qrcode"), { text: qrData, width: 200, height: 200 });
                document.getElementById('qr-modal').classList.remove('hidden');
            });
        };

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userRef = doc(db, "users", user.uid);
                // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                const unsub = await getDoc(userRef); 
                const data = unsub.data();
                document.getElementById('user-name').innerText = data.name;
                document.getElementById('balance').innerText = data.balance.toLocaleString() + " ‚ÇΩ";
                document.getElementById('card-full-info').innerText = `${data.cardNum.replace(/(.{4})/g, '$1 ')} | ${data.exp} | CVV ${data.cvv}`;
                
                const histDiv = document.getElementById('history-list');
                histDiv.innerHTML = data.history.reverse().map(t => `
                    <div class="flex justify-between border-b py-3">
                        <span class="text-xs text-gray-500">${t.date}</span>
                        <span class="font-bold ${t.type === 'in' ? 'text-green-500' : 'text-red-500'}">
                            ${t.type === 'in' ? '+' : '-'}${t.amount} ‚ÇΩ
                        </span>
                    </div>
                `).join('');
                showScreen('main-screen');
            } else { showScreen('login-screen'); }
        });

        window.logout = () => signOut(auth);
    </script>

    <style>
        .orange-btn { @apply bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-6 rounded-2xl transition-all active:scale-95 shadow-lg shadow-orange-200; }
        .card-bg { background: linear-gradient(135deg, #FF8C00 0%, #FF4500 100%); }
        .blur-val { filter: blur(6px); transition: 0.3s; }
        .blur-val:active { filter: blur(0); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="screen flex flex-col items-center justify-center min-h-screen p-6">
        <div class="text-center mb-10">
            <h1 class="text-5xl font-black text-orange-500 italic tracking-tighter">BINGUS<span class="text-slate-800 font-light">BANK</span></h1>
            <p class="text-slate-400 mt-2">–ú—è—É-–±–∞–Ω–∫–∏–Ω–≥ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</p>
        </div>
        <div class="bg-white p-8 rounded-[40px] shadow-2xl w-full max-w-md border border-slate-100">
            <input id="login-email" type="email" placeholder="Email" class="w-full mb-4 p-4 bg-slate-50 rounded-2xl outline-none focus:ring-2 ring-orange-500">
            <input id="login-pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full mb-6 p-4 bg-slate-50 rounded-2xl outline-none focus:ring-2 ring-orange-500">
            <button onclick="handleLogin()" class="orange-btn w-full">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
            <button onclick="showScreen('reg-screen')" class="mt-6 text-orange-500 font-semibold block mx-auto">–°—Ç–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–º</button>
        </div>
    </div>

    <!-- REGISTER SCREEN -->
    <div id="reg-screen" class="screen hidden flex flex-col items-center justify-center min-h-screen p-6">
        <div class="bg-white p-10 rounded-[40px] shadow-2xl w-full max-w-md">
            <h2 class="text-3xl font-bold mb-8">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input id="reg-name" type="text" placeholder="–í–∞—à–µ –∏–º—è" class="w-full mb-4 p-4 bg-slate-50 rounded-2xl outline-none">
            <input id="reg-email" type="email" placeholder="Email" class="w-full mb-4 p-4 bg-slate-50 rounded-2xl outline-none">
            <input id="reg-pass" type="password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" class="w-full mb-8 p-4 bg-slate-50 rounded-2xl outline-none">
            <button onclick="handleSignUp()" class="orange-btn w-full">–û—Ç–∫—Ä—ã—Ç—å —Å—á–µ—Ç</button>
            <button onclick="showScreen('login-screen')" class="mt-4 text-slate-400 w-full">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="main-screen" class="screen hidden animate-in fade-in duration-500">
        <!-- Header -->
        <nav class="bg-white p-6 flex justify-between items-center shadow-sm sticky top-0 z-10">
            <span class="font-black text-orange-500 text-xl tracking-tighter italic">BINGUS</span>
            <div class="flex items-center gap-4">
                <span id="user-name" class="font-bold text-slate-700"></span>
                <button onclick="logout()" class="bg-slate-100 p-2 px-4 rounded-full text-xs font-bold hover:bg-red-50 hover:text-red-500 transition-colors">–í–´–ô–¢–ò</button>
            </div>
        </nav>

        <div class="p-6 max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 mt-4">
            <!-- Left: Wallet -->
            <div class="lg:col-span-2">
                <div class="card-bg p-8 rounded-[35px] text-white shadow-2xl shadow-orange-200 h-64 flex flex-col justify-between relative overflow-hidden">
                    <div class="flex justify-between items-start relative z-10">
                        <div class="opacity-80 text-xs font-bold uppercase tracking-widest">Premium Card</div>
                        <img src="https://upload.wikimedia.org" class="h-8">
                    </div>
                    <div class="relative z-10">
                        <p class="text-xs opacity-60 mb-1">–î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã (–Ω–∞–∂–º–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å)</p>
                        <p id="card-full-info" class="text-xl font-mono tracking-tighter blur-val cursor-pointer" onclick="const p = prompt('–ü–∞—Ä–æ–ª—å:'); if(p) this.classList.remove('blur-val')">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ | **/** | ***</p>
                    </div>
                    <!-- Circle Decor -->
                    <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white opacity-10 rounded-full"></div>
                </div>

                <div class="mt-8 flex flex-col md:flex-row justify-between items-end gap-4">
                    <div>
                        <p class="text-slate-400 font-medium">–î–æ—Å—Ç—É–ø–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫</p>
                        <h1 id="balance" class="text-6xl font-black text-slate-900 tracking-tighter">0 ‚ÇΩ</h1>
                    </div>
                    <div class="flex gap-2 w-full md:w-auto">
                        <button onclick="showScreen('transfer-screen')" class="orange-btn flex-1 md:px-10">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                        <button onclick="showScreen('request-screen')" class="orange-btn flex-1 bg-slate-900 shadow-slate-200 hover:bg-slate-800">–ó–∞–ø—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                </div>

                <!-- Fast Actions -->
                <div class="mt-12">
                    <h3 class="font-bold text-lg mb-4">–°–µ—Ä–≤–∏—Å—ã</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white p-6 rounded-3xl text-center border border-slate-100 hover:shadow-md transition-shadow cursor-pointer">
                            <div class="text-3xl mb-2">üì≤</div>
                            <span class="text-xs font-bold uppercase tracking-tighter">–°–ë–ü</span>
                        </div>
                        <div class="bg-white p-6 rounded-3xl text-center border border-slate-100 hover:shadow-md transition-shadow cursor-pointer">
                            <div class="text-3xl mb-2">üßæ</div>
                            <span class="text-xs font-bold uppercase tracking-tighter">–°—á–µ—Ç–∞</span>
                        </div>
                        <div class="bg-white p-6 rounded-3xl text-center border border-slate-100 hover:shadow-md transition-shadow cursor-pointer">
                            <div class="text-3xl mb-2">üéÅ</div>
                            <span class="text-xs font-bold uppercase tracking-tighter">–ë–æ–Ω—É—Å—ã</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: History -->
            <div class="bg-white p-8 rounded-[40px] shadow-sm border border-slate-100 h-[600px] flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-black text-xl">–ò—Å—Ç–æ—Ä–∏—è</h3>
                    <span class="text-orange-500 text-2xl">üïí</span>
                </div>
                <div id="history-list" class="overflow-y-auto flex-1 space-y-2">
                    <!-- Transactions -->
                </div>
            </div>
        </div>
    </div>

    <!-- TRANSFER SCREEN -->
    <div id="transfer-screen" class="screen hidden fixed inset-0 bg-white z-50 p-6 flex items-center justify-center">
        <div class="w-full max-w-md">
            <h2 class="text-4xl font-black mb-8 text-center">–ü–µ—Ä–µ–≤–æ–¥ <span class="text-orange-500">–¥–µ–Ω–µ–≥</span></h2>
            <div class="space-y-4">
                <input id="target-card" type="text" placeholder="–ö–∞—Ä—Ç–∞ –∏–ª–∏ Email" class="w-full p-5 bg-slate-100 rounded-3xl outline-none focus:ring-2 ring-orange-500">
                <input id="transfer-amount" type="number" placeholder="–°—É–º–º–∞ (‚ÇΩ)" class="w-full p-5 bg-slate-100 rounded-3xl outline-none focus:ring-2 ring-orange-500 text-3xl font-bold">
                <button onclick="handleTransfer()" class="orange-btn w-full py-6 text-xl">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ</button>
                <button onclick="showScreen('main-screen')" class="w-full text-slate-400 font-bold py-4">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <!-- REQUEST SCREEN -->
    <div id="request-screen" class="screen hidden fixed inset-0 bg-white z-50 p-6 flex items-center justify-center">
        <div class="w-full max-w-md text-center">
            <h2 class="text-3xl font-black mb-4">–°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å</h2>
            <p class="text-slate-400 mb-8">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å</p>
            <input id="req-amount" type="number" placeholder="0.00" class="w-full p-5 bg-slate-100 rounded-3xl text-center text-4xl font-black mb-6 outline-none">
            <button onclick="generateQR()" class="orange-btn w-full mb-6">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥</button>
            
            <div id="qr-modal" class="hidden animate-bounce-in">
                <div class="bg-slate-50 p-6 rounded-[40px] inline-block mb-4 border-2 border-dashed border-orange-200">
                    <div id="qrcode"></div>
                </div>
                <p class="text-sm font-bold text-orange-500 uppercase tracking-widest">–†–∞–±–æ—á–∏–π QR –°–ë–ü</p>
            </div>
            
            <button onclick="showScreen('main-screen')" class="block mx-auto mt-8 text-slate-300 font-bold">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

</body>
</html>
